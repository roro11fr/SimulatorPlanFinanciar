{% load static %}
{% load simulator_extras %}

<h2>Rezultat Simulare</h2>

<p><strong>Data:</strong> {{ simulare.created_at }}</p>
<p><strong>InvestiÈ›ie iniÈ›ialÄƒ:</strong> {{ simulare.initial_investment }} RON</p>

{% if simulare.investment_plan.monthly_contribution %}
<p><strong>ContribuÈ›ii lunare:</strong> {{ simulare.investment_plan.monthly_contribution }} RON</p>
{% endif %}

<p><strong>Index bursier:</strong> {{ simulare.investment_plan.get_stock_index_display }}</p>
<p><strong>Ani:</strong> {{ simulare.years }}</p>

<hr>

<h3>ğŸ“Š Compararea metodelor de simulare</h3>
<p>AfiÈ™Äƒm evoluÈ›ia portofoliului folosind trei metode Monte Carlo. Scopul este sÄƒ vedem care dintre ele oferÄƒ cel mai echilibrat raport Ã®ntre <strong>randament estimat</strong> È™i <strong>stabilitate (incertitudine)</strong>.</p>

<div class="alert alert-info mb-4">
  <h5>ğŸ“˜ Cum se interpreteazÄƒ graficele:</h5>
  <ul>
    <li><strong>ğŸ”µ Linia albastrÄƒ:</strong> valoarea medie estimatÄƒ a portofoliului Ã®n timp (media a 500 de simulÄƒri)</li>
    <li><strong>ğŸŸ© Linia verde Ã®ntreruptÄƒ:</strong> suma totalÄƒ investitÄƒ de utilizator (contribuÈ›ii lunare)</li>
    <li><strong>ğŸ”· Zona albastrÄƒ:</strong> interval Ã®n care se aflÄƒ 80% dintre simulÄƒri (10â€“90%) â€“ aratÄƒ riscurile</li>
  </ul>
 <p><strong>â„¹ï¸ ObservaÈ›ie:</strong><br>
Cu cÃ¢t <strong>linia albastrÄƒ</strong> (valoarea simulatÄƒ) se aflÄƒ mai sus faÈ›Äƒ de <strong>linia verde</strong> (contribuÈ›iile totale), cu atÃ¢t simularea indicÄƒ un <u>profit estimat mai mare</u>.<br>
Ãn acelaÈ™i timp, cu cÃ¢t <strong>zona albastrÄƒ</strong> (intervalul 10â€“90%) este <u>mai Ã®ngustÄƒ</u>, cu atÃ¢t rezultatul este considerat <u>mai stabil È™i predictibil</u>, adicÄƒ riscul estimat este mai mic.
</p>
{% for metoda, grafic in chart_htmls.items %}
  <div class="card mb-5 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">
        {% if metoda == metoda_aleasa %}
          â­ <strong>{{ metoda }} (Metoda aleasÄƒ)</strong>
        {% else %}
          {{ metoda }}
        {% endif %}
      </h4>

      <p class="text-muted" style="font-style: italic;">
        {% if metoda == "Bootstrapping" %}
          BazatÄƒ pe randamente istorice reale (ex. S&P 500). Reproduce comportamentul trecut al pieÈ›ei pentru a estima viitorul.
        {% elif metoda == "Clasic" %}
          UtilizeazÄƒ o distribuÈ›ie normalÄƒ (medie È™i deviaÈ›ie standard fixÄƒ) pentru a genera randamente anuale ipotetice.
        {% elif metoda == "GBM" %}
          AplicÄƒ modelul Geometric Brownian Motion, folosit frecvent Ã®n finanÈ›e, pentru a simula evoluÈ›ii ale pieÈ›ei cu volatilitate controlatÄƒ.
        {% else %}
          Simulare personalizatÄƒ.
        {% endif %}
      </p>

      <div class="interactive-plot mb-4">
        {{ grafic|safe }}
      </div>
    </div>
  </div>
{% endfor %}


<hr>

<h3>Ce trebuie sÄƒ Ã®nÈ›elegi din aceste grafice?</h3>
<p>
  Fiecare metodÄƒ simuleazÄƒ Ã®n mod diferit viitorul portofoliului tÄƒu. Unele se bazeazÄƒ pe date istorice reale (Bootstrapping), altele pe modele statistice teoretice (Clasic, GBM).
</p>
<p>
  Metoda marcatÄƒ cu <strong>â­</strong> a fost aleasÄƒ automat deoarece oferÄƒ <strong>cea mai micÄƒ eroare standard</strong> â€“ adicÄƒ prezice viitorul cu <strong>cea mai mare stabilitate statisticÄƒ</strong>. Asta Ã®nseamnÄƒ cÄƒ este cea mai <u>fiabilÄƒ</u> dintre cele testate.
</p>
<p>
  DacÄƒ randamentul estimat e puÈ›in mai mic, dar vine cu o incertitudine semnificativ redusÄƒ, metoda este consideratÄƒ mai â€sigurÄƒâ€ pentru tine ca investitor.
</p>

<hr>

<h3>Caz de utilizator: Tu, investitorul</h3>
<p>
  Ai decis sÄƒ investeÈ™ti Ã®ntr-un plan financiar pe termen lung. Pe baza informaÈ›iilor oferite:
</p>

<ul>
  <li><strong>InvestiÈ›ie iniÈ›ialÄƒ:</strong> {{ simulare.initial_investment|floatformat:2 }} RON</li>
  <li><strong>ContribuÈ›ii lunare:</strong> {{ simulare.investment_plan.monthly_contribution|floatformat:2 }} RON</li>
  <li><strong>Index bursier ales:</strong> {{ simulare.investment_plan.get_stock_index_display }}</li>
  <li><strong>Durata simulÄƒrii:</strong> {{ simulare.years }} ani</li>
  <li><strong>NumÄƒr simulÄƒri:</strong> {{ simulare.simulations_run }}</li>
</ul>

<p>
  DupÄƒ analizarea rezultatelor generate de cele trei metode, sistemul a ales automat <strong>{{ metoda_aleasa }}</strong> deoarece aceasta a avut cea mai micÄƒ eroare standard.
</p>

<p>
  Acest lucru Ã®nseamnÄƒ cÄƒ, statistic, metoda <strong>{{ metoda_aleasa }}</strong> oferÄƒ cea mai stabilÄƒ estimare a portofoliului tÄƒu viitor. Ea reduce incertitudinea È™i Ã®È›i permite sÄƒ iei o decizie informatÄƒ, Ã®n funcÈ›ie de profilul tÄƒu de risc.
</p>

<p>
  De exemplu, dacÄƒ linia albastrÄƒ (valoarea simulatÄƒ) rÄƒmÃ¢ne peste linia verde (contribuÈ›iile tale totale), Ã®nseamnÄƒ cÄƒ ai È™anse mari de profit. Zona albastrÄƒ latÄƒ Ã®nseamnÄƒ risc; zona Ã®ngustÄƒ Ã®nseamnÄƒ stabilitate.
</p>

<p><strong>ğŸ” Concluzie personalizatÄƒ:</strong> Pe baza datelor introduse, ai acum o viziune clarÄƒ asupra evoluÈ›iei posibile a planului tÄƒu de investiÈ›ii, folosind metoda aleasÄƒ automat. PoÈ›i pÄƒstra simularea, o poÈ›i compara cu altele sau poÈ›i ajusta parametrii pentru alte scenarii.</p

<hr>

<div class="mt-4">
  <a href="{% url 'istoric_simulari' plan.id %}" class="btn btn-sm btn-secondary">Vezi istoric</a>
  <a href="{% url 'dashboard' %}" class="btn btn-primary">Ãnapoi la dashboard</a>
</div>

{% if simulare.result_image_path %}
  <div class="mt-5">
    <h3>ğŸ“· Graficul salvat</h3>
    <img src="{{ MEDIA_URL }}{{ simulare.result_image_path }}" alt="Graficul rezultatului simulÄƒrii" class="img-fluid">
  </div>
{% endif %}

{% if simulare.error_message %}
  <div class="alert alert-danger mt-4">
    <strong>âš ï¸ Eroare:</strong> {{ simulare.error_message }}
  </div>
{% endif %}
