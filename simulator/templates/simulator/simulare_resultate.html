{% load static %}
{% load simulator_extras %}

<h2>Rezultat Simulare</h2>

<p><strong>Data:</strong> {{ simulare.created_at }}</p>
<p><strong>Investiție inițială:</strong> {{ simulare.initial_investment }} RON</p>

{% if simulare.investment_plan.monthly_contribution %}
<p><strong>Contribuții lunare:</strong> {{ simulare.investment_plan.monthly_contribution }} RON</p>
{% endif %}

<p><strong>Index bursier:</strong> {{ simulare.investment_plan.get_stock_index_display }}</p>
<p><strong>Ani:</strong> {{ simulare.years }}</p>

<hr>

<h3>📊 Compararea metodelor de simulare</h3>
<p>Afișăm evoluția portofoliului folosind trei metode Monte Carlo. Scopul este să vedem care dintre ele oferă cel mai echilibrat raport între <strong>randament estimat</strong> și <strong>stabilitate (incertitudine)</strong>.</p>

<div class="alert alert-info mb-4">
  <h5>📘 Cum se interpretează graficele:</h5>
  <ul>
    <li><strong>🔵 Linia albastră:</strong> valoarea medie estimată a portofoliului în timp (media a 500 de simulări)</li>
    <li><strong>🟩 Linia verde întreruptă:</strong> suma totală investită de utilizator (contribuții lunare)</li>
    <li><strong>🔷 Zona albastră:</strong> interval în care se află 80% dintre simulări (10–90%) – arată riscurile</li>
  </ul>
 <p><strong>ℹ️ Observație:</strong><br>
Cu cât <strong>linia albastră</strong> (valoarea simulată) se află mai sus față de <strong>linia verde</strong> (contribuțiile totale), cu atât simularea indică un <u>profit estimat mai mare</u>.<br>
În același timp, cu cât <strong>zona albastră</strong> (intervalul 10–90%) este <u>mai îngustă</u>, cu atât rezultatul este considerat <u>mai stabil și predictibil</u>, adică riscul estimat este mai mic.
</p>
{% for metoda, grafic in chart_htmls.items %}
  <div class="card mb-5 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">
        {% if metoda == metoda_aleasa %}
          ⭐ <strong>{{ metoda }} (Metoda aleasă)</strong>
        {% else %}
          {{ metoda }}
        {% endif %}
      </h4>

      <p class="text-muted" style="font-style: italic;">
        {% if metoda == "Bootstrapping" %}
          Bazată pe randamente istorice reale (ex. S&P 500). Reproduce comportamentul trecut al pieței pentru a estima viitorul.
        {% elif metoda == "Clasic" %}
          Utilizează o distribuție normală (medie și deviație standard fixă) pentru a genera randamente anuale ipotetice.
        {% elif metoda == "GBM" %}
          Aplică modelul Geometric Brownian Motion, folosit frecvent în finanțe, pentru a simula evoluții ale pieței cu volatilitate controlată.
        {% else %}
          Simulare personalizată.
        {% endif %}
      </p>

      <div class="interactive-plot mb-4">
        {{ grafic|safe }}
      </div>
    </div>
  </div>
{% endfor %}


<hr>

<h3>Ce trebuie să înțelegi din aceste grafice?</h3>
<p>
  Fiecare metodă simulează în mod diferit viitorul portofoliului tău. Unele se bazează pe date istorice reale (Bootstrapping), altele pe modele statistice teoretice (Clasic, GBM).
</p>
<p>
  Metoda marcată cu <strong>⭐</strong> a fost aleasă automat deoarece oferă <strong>cea mai mică eroare standard</strong> – adică prezice viitorul cu <strong>cea mai mare stabilitate statistică</strong>. Asta înseamnă că este cea mai <u>fiabilă</u> dintre cele testate.
</p>
<p>
  Dacă randamentul estimat e puțin mai mic, dar vine cu o incertitudine semnificativ redusă, metoda este considerată mai „sigură” pentru tine ca investitor.
</p>

<hr>

<h3>Caz de utilizator: Tu, investitorul</h3>
<p>
  Ai decis să investești într-un plan financiar pe termen lung. Pe baza informațiilor oferite:
</p>

<ul>
  <li><strong>Investiție inițială:</strong> {{ simulare.initial_investment|floatformat:2 }} RON</li>
  <li><strong>Contribuții lunare:</strong> {{ simulare.investment_plan.monthly_contribution|floatformat:2 }} RON</li>
  <li><strong>Index bursier ales:</strong> {{ simulare.investment_plan.get_stock_index_display }}</li>
  <li><strong>Durata simulării:</strong> {{ simulare.years }} ani</li>
  <li><strong>Număr simulări:</strong> {{ simulare.simulations_run }}</li>
</ul>

<p>
  După analizarea rezultatelor generate de cele trei metode, sistemul a ales automat <strong>{{ metoda_aleasa }}</strong> deoarece aceasta a avut cea mai mică eroare standard.
</p>

<p>
  Acest lucru înseamnă că, statistic, metoda <strong>{{ metoda_aleasa }}</strong> oferă cea mai stabilă estimare a portofoliului tău viitor. Ea reduce incertitudinea și îți permite să iei o decizie informată, în funcție de profilul tău de risc.
</p>

<p>
  De exemplu, dacă linia albastră (valoarea simulată) rămâne peste linia verde (contribuțiile tale totale), înseamnă că ai șanse mari de profit. Zona albastră lată înseamnă risc; zona îngustă înseamnă stabilitate.
</p>

<p><strong>🔍 Concluzie personalizată:</strong> Pe baza datelor introduse, ai acum o viziune clară asupra evoluției posibile a planului tău de investiții, folosind metoda aleasă automat. Poți păstra simularea, o poți compara cu altele sau poți ajusta parametrii pentru alte scenarii.</p

<hr>

<div class="mt-4">
  <a href="{% url 'istoric_simulari' plan.id %}" class="btn btn-sm btn-secondary">Vezi istoric</a>
  <a href="{% url 'dashboard' %}" class="btn btn-primary">Înapoi la dashboard</a>
</div>

{% if simulare.result_image_path %}
  <div class="mt-5">
    <h3>📷 Graficul salvat</h3>
    <img src="{{ MEDIA_URL }}{{ simulare.result_image_path }}" alt="Graficul rezultatului simulării" class="img-fluid">
  </div>
{% endif %}

{% if simulare.error_message %}
  <div class="alert alert-danger mt-4">
    <strong>⚠️ Eroare:</strong> {{ simulare.error_message }}
  </div>
{% endif %}
